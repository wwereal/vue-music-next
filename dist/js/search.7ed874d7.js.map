{"version":3,"sources":["webpack:///./src/views/search.vue","webpack:///./src/views/search.vue?3944","webpack:///./src/components/wrap-scroll/index.js","webpack:///./src/views/search.vue?681d"],"names":["class","query","ref","hotKeys","item","key","id","addQuery","showConfirm","text","confirm-btn-text","clearSearch","searches","searchHistory","deleteSearch","length","selectSong","selectSinger","Component","appear","name","data","selectedSinger","components","Confirm","Scroll","SearchList","SearchInput","Suggest","setup","scrollRef","confirmRef","store","state","router","saveSearch","refreshScroll","value","scroll","refresh","s","song","dispatch","singer","cacheSinger","push","path","mid","session","set","show","then","result","newQuery","render","__scopeId","props","emits","ctx","h","mergeProps","$props","onScroll","e","$emit","default","withCtx","renderSlot","$slots","computed","useStore","playlist","watch","nextTick"],"mappings":"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","file":"js/search.7ed874d7.js","sourcesContent":["<template>\n  <div class=\"search\">\n    <div class=\"search-input-wrapper\">\n      <search-input v-model=\"query\"></search-input>\n    </div>\n    <scroll\n      ref=\"scrollRef\"\n      class=\"search-content\"\n      v-show=\"!query\"\n    >\n      <div>\n        <div class=\"hot-keys\">\n          <h1 class=\"title\">热门搜索</h1>\n          <ul>\n            <li\n              class=\"item\"\n              v-for=\"item in hotKeys\"\n              :key=\"item.id\"\n              @click=\"addQuery(item.key)\"\n            >\n              <span>{{item.key}}</span>\n            </li>\n          </ul>\n        </div>\n        <div class=\"search-history\" v-show=\"searchHistory.length\">\n          <h1 class=\"title\">\n            <span class=\"text\">搜索历史</span>\n            <span class=\"clear\" @click=\"showConfirm\">\n              <i class=\"icon-clear\"></i>\n            </span>\n          </h1>\n          <confirm\n            ref=\"confirmRef\"\n            text=\"是否清空所有搜索历史\"\n            confirm-btn-text=\"清空\"\n            @confirm=\"clearSearch\"\n          >\n          </confirm>\n          <search-list\n            :searches=\"searchHistory\"\n            @select=\"addQuery\"\n            @delete=\"deleteSearch\"\n          ></search-list>\n        </div>\n      </div>\n    </scroll>\n    <div class=\"search-result\" v-show=\"query\">\n      <suggest\n        :query=\"query\"\n        @select-song=\"selectSong\"\n        @select-singer=\"selectSinger\"\n      ></suggest>\n    </div>\n    <router-view v-slot=\"{ Component }\">\n      <transition appear name=\"slide\">\n        <component :is=\"Component\" :data=\"selectedSinger\"/>\n      </transition>\n    </router-view>\n  </div>\n</template>\n\n<script>\n  import SearchInput from '@/components/search/search-input'\n  import Suggest from '@/components/search/suggest'\n  import SearchList from '@/components/base/search-list/search-list'\n  import Scroll from '@/components/wrap-scroll'\n  import Confirm from '@/components/base/confirm/confirm'\n  import { ref, computed, watch, nextTick } from 'vue'\n  import { getHotKeys } from '@/service/search'\n  import { useStore } from 'vuex'\n  import { useRouter } from 'vue-router'\n  import storage from 'good-storage'\n  import { SINGER_KEY } from '@/assets/js/constant'\n  import useSearchHistory from '@/components/search/use-search-history'\n\n  export default {\n    name: 'search',\n    components: {\n      Confirm,\n      Scroll,\n      SearchList,\n      SearchInput,\n      Suggest\n    },\n    setup() {\n      const query = ref('')\n      const hotKeys = ref([])\n      const selectedSinger = ref(null)\n      const scrollRef = ref(null)\n      const confirmRef = ref(null)\n\n      const store = useStore()\n      const searchHistory = computed(() => store.state.searchHistory)\n\n      const router = useRouter()\n\n      const { saveSearch, deleteSearch, clearSearch } = useSearchHistory()\n\n      getHotKeys().then((result) => {\n        hotKeys.value = result.hotKeys\n      })\n\n      watch(query, async (newQuery) => {\n        if (!newQuery) {\n          await nextTick()\n          refreshScroll()\n        }\n      })\n\n      function refreshScroll() {\n        scrollRef.value.scroll.refresh()\n      }\n\n      function addQuery(s) {\n        query.value = s\n      }\n\n      function selectSong(song) {\n        saveSearch(query.value)\n        store.dispatch('addSong', song)\n      }\n\n      function selectSinger(singer) {\n        saveSearch(query.value)\n        selectedSinger.value = singer\n        cacheSinger(singer)\n\n        router.push({\n          path: `/search/${singer.mid}`\n        })\n      }\n\n      function cacheSinger(singer) {\n        storage.session.set(SINGER_KEY, singer)\n      }\n\n      function showConfirm() {\n        confirmRef.value.show()\n      }\n\n      return {\n        scrollRef,\n        confirmRef,\n        query,\n        hotKeys,\n        selectedSinger,\n        searchHistory,\n        addQuery,\n        selectSong,\n        selectSinger,\n        showConfirm,\n        // searchHistory\n        deleteSearch,\n        clearSearch\n      }\n    }\n  }\n</script>\n\n<style lang=\"scss\" scoped>\n  .search {\n    position: fixed;\n    width: 100%;\n    top: 88px;\n    bottom: 0;\n    display: flex;\n    flex-direction: column;\n    .search-input-wrapper {\n      margin: 20px;\n    }\n    .search-content {\n      flex: 1;\n      overflow: hidden;\n      .hot-keys {\n        margin: 0 20px 20px 20px;\n        .title {\n          margin-bottom: 20px;\n          font-size: $font-size-medium;\n          color: $color-text-l;\n        }\n        .item {\n          display: inline-block;\n          padding: 5px 10px;\n          margin: 0 20px 10px 0;\n          border-radius: 6px;\n          background: $color-highlight-background;\n          font-size: $font-size-medium;\n          color: $color-text-d;\n        }\n      }\n      .search-history {\n        position: relative;\n        margin: 0 20px;\n        .title {\n          display: flex;\n          align-items: center;\n          height: 40px;\n          font-size: $font-size-medium;\n          color: $color-text-l;\n          .text {\n            flex: 1;\n          }\n          .clear {\n            @include extend-click();\n            .icon-clear {\n              font-size: $font-size-medium;\n              color: $color-text-d;\n            }\n          }\n        }\n      }\n    }\n    .search-result {\n      flex: 1;\n      overflow: hidden;\n    }\n  }\n</style>\n","import { render } from \"./search.vue?vue&type=template&id=44916e86&scoped=true\"\nimport script from \"./search.vue?vue&type=script&lang=js\"\nexport * from \"./search.vue?vue&type=script&lang=js\"\n\nimport \"./search.vue?vue&type=style&index=0&id=44916e86&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-44916e86\"\n\nexport default script","import { h, mergeProps, withCtx, renderSlot, ref, computed, watch, nextTick } from 'vue'\nimport Scroll from '@/components/base/scroll/scroll'\nimport { useStore } from 'vuex'\n\nexport default {\n  name: 'wrap-scroll',\n  props: Scroll.props,\n  emits: Scroll.emits,\n  render(ctx) {\n    return h(Scroll, mergeProps({\n      ref: 'scrollRef'\n    }, ctx.$props, {\n      onScroll: (e) => {\n        ctx.$emit('scroll', e)\n      }\n    }), {\n      default: withCtx(() => {\n        return [renderSlot(ctx.$slots, 'default')]\n      })\n    })\n  },\n  setup() {\n    const scrollRef = ref(null)\n    const scroll = computed(() => {\n      return scrollRef.value.scroll\n    })\n\n    const store = useStore()\n    const playlist = computed(() => store.state.playlist)\n\n    watch(playlist, async () => {\n      await nextTick()\n      scroll.value.refresh()\n    })\n\n    return {\n      scrollRef,\n      scroll\n    }\n  }\n}\n","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./search.vue?vue&type=style&index=0&id=44916e86&lang=scss&scoped=true\""],"sourceRoot":""}