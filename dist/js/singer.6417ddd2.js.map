{"version":3,"sources":["webpack:///./src/views/singer.vue","webpack:///./src/components/index-list/index-list.vue","webpack:///./src/components/index-list/use-fixed.js","webpack:///./src/components/index-list/use-shortcut.js","webpack:///./src/components/index-list/index-list.vue?f0bf","webpack:///./src/views/singer.vue?f994","webpack:///./src/views/singer.vue?9c86","webpack:///./src/components/wrap-scroll/index.js","webpack:///./src/service/singer.js","webpack:///./src/components/index-list/index-list.vue?0f79"],"names":["class","data","singers","selectSinger","Component","appear","name","selectedSinger","length","ref","probe-type","onScroll","group","key","title","list","item","id","onItemClick","pic","style","fixedStyle","fixedTitle","onShortcutTouchStart","onShortcutTouchMove","shortcutList","index","data-index","currentIndex","useFixed","props","TITLE_HEIGHT","groupRef","listHeights","scrollY","distance","computed","distanceVal","value","diff","transform","currentGroup","calculate","children","listHeightsVal","height","push","i","clientHeight","pos","y","watch","nextTick","newY","heightTop","heightBottom","useShortcut","ANCHOR_HEIGHT","scrollRef","map","touch","e","anchorIndex","parseInt","target","dataset","y1","touches","pageY","scrollTo","y2","delta","isNaN","Math","max","min","targetEl","scroll","scrollToElement","components","Scroll","type","Array","default","emits","setup","emit","render","__scopeId","IndexList","created","result","methods","singer","this","cacheSinger","$router","path","mid","session","set","ctx","h","mergeProps","$props","$emit","withCtx","renderSlot","$slots","store","useStore","playlist","state","refresh","getSingerList","get","getSingerDetail"],"mappings":"8MACOA,MAAM,U,uLAAX,eAaM,MAbN,EAaM,CAXJ,eAGc,GAFXC,KAAM,EAAAC,QACN,SAAQ,EAAAC,c,4BAGX,eAIc,Q,WAHZ,gBADqBC,EACrB,EADqBA,UACrB,MAD8B,CAC9B,eAEa,QAFDC,OAAA,GAAOC,KAAK,S,YACtB,iBAAmD,E,iBAAnD,eAAmD,eAAnCF,GAAS,CAAGH,KAAM,EAAAM,gBAAc,sB,iCATtB,EAAAL,QAAQM,a,6HCMlCC,IAAI,Y,GAMAT,MAAM,S,GAQDA,MAAM,U,GACLA,MAAM,Q,GAWbA,MAAM,e,gIAhCf,eAoDS,GAnDPA,MAAM,aACLU,aAAY,EACZ,SAAQ,EAAAC,SACTF,IAAI,a,YAEJ,iBAmBK,CAnBL,eAmBK,KAnBL,EAmBK,E,mBAlBH,eAiBK,2BAhBa,EAAAR,MAAI,SAAbW,G,wBADT,eAiBK,MAfFC,IAAKD,EAAME,MACZd,MAAM,S,CAEN,eAAsC,KAAtC,EAAsC,eAAlBY,EAAME,OAAK,GAC/B,eAUK,Y,mBATH,eAQK,2BAPYF,EAAMG,MAAI,SAAlBC,G,wBADT,eAQK,MANFH,IAAKG,EAAKC,GACXjB,MAAM,OACL,QAAK,mBAAE,EAAAkB,YAAYF,K,gBAEpB,eAAsC,MAAtC,EAAsC,W,GAAVA,EAAKG,OACjC,eAAuC,OAAvC,EAAuC,eAAlBH,EAAKV,MAAI,I,0DAMtC,eAMM,OALJN,MAAM,QAELoB,MAAO,EAAAC,Y,CAER,eAA6C,MAA7C,EAA6C,eAAlB,EAAAC,YAAU,I,YAH7B,EAAAA,cAMV,eAgBM,OAfJtB,MAAM,WACL,aAAU,8CAAe,EAAAuB,sBAAA,EAAAA,qBAAA,qBAAoB,qBAC7C,YAAS,8CAAe,EAAAC,qBAAA,EAAAA,oBAAA,qBAAmB,qBAC3C,WAAQ,4BAAT,cAAsB,sB,CAEtB,eASK,Y,mBARH,eAOK,2BANqB,EAAAC,cAAY,SAA5BT,EAAMU,G,wBADhB,eAOK,MALFb,IAAKG,EACLW,aAAYD,EACb1B,MAAK,CAAC,OAAM,SACO,EAAA4B,eAAeF,K,eAChCV,GAAI,sB,qDC/CD,SAASa,EAASC,GAC/B,IAAMC,EAAe,GACfC,EAAWvB,eAAI,MACfwB,EAAcxB,eAAI,IAClByB,EAAUzB,eAAI,GACdmB,EAAenB,eAAI,GACnB0B,EAAW1B,eAAI,GAEfY,EAAae,gBAAS,WAC1B,IAAMC,EAAcF,EAASG,MACvBC,EAAQF,EAAc,GAAKA,EAAcN,EAAgBM,EAAcN,EAAe,EAC5F,MAAO,CACLS,UAAW,iBAAF,OAAmBD,EAAnB,aAIPjB,EAAac,gBAAS,WAC1B,GAAIF,EAAQI,MAAQ,EAClB,MAAO,GAET,IAAMG,EAAeX,EAAM7B,KAAK2B,EAAaU,OAC7C,OAAOG,EAAeA,EAAa3B,MAAQ,MAoB7C,SAAS4B,IACP,IAAM3B,EAAOiB,EAASM,MAAMK,SACtBC,EAAiBX,EAAYK,MAC/BO,EAAS,EAEbD,EAAepC,OAAS,EACxBoC,EAAeE,KAAKD,GAEpB,IAAK,IAAIE,EAAI,EAAGA,EAAIhC,EAAKP,OAAQuC,IAC/BF,GAAU9B,EAAKgC,GAAGC,aAClBJ,EAAeE,KAAKD,GAIxB,SAASlC,EAASsC,GAChBf,EAAQI,OAASW,EAAIC,EAGvB,OAnCAC,gBAAM,kBAAMrB,EAAM7B,OAAb,wCAAmB,8GAChBmD,iBADgB,OAEtBV,IAFsB,4CAKxBS,eAAMjB,GAAS,SAACmB,GAEd,IADA,IAAMT,EAAiBX,EAAYK,MAC1BS,EAAI,EAAGA,EAAIH,EAAepC,OAAS,EAAGuC,IAAK,CAClD,IAAMO,EAAYV,EAAeG,GAC3BQ,EAAeX,EAAeG,EAAI,GACpCM,GAAQC,GAAaD,GAAQE,IAC/B3B,EAAaU,MAAQS,EACrBZ,EAASG,MAAQiB,EAAeF,OAuB/B,CACLrB,WACArB,WACAW,aACAD,aACAO,gB,UChEW,SAAS4B,EAAY1B,EAAOE,GACzC,IAAMyB,EAAgB,GAChBC,EAAYjD,eAAI,MAEhBgB,EAAeW,gBAAS,WAC5B,OAAON,EAAM7B,KAAK0D,KAAI,SAAC/C,GACrB,OAAOA,EAAME,YAIX8C,EAAQ,GAEd,SAASrC,EAAqBsC,GAC5B,IAAMC,EAAcC,SAASF,EAAEG,OAAOC,QAAQvC,OAC9CkC,EAAMM,GAAKL,EAAEM,QAAQ,GAAGC,MACxBR,EAAME,YAAcA,EAEpBO,EAASP,GAGX,SAAStC,EAAoBqC,GAC3BD,EAAMU,GAAKT,EAAEM,QAAQ,GAAGC,MACxB,IAAMG,GAASX,EAAMU,GAAKV,EAAMM,IAAMT,EAAgB,EAChDK,EAAcF,EAAME,YAAcS,EAExCF,EAASP,GAGX,SAASO,EAAS3C,GAChB,IAAI8C,MAAM9C,GAAV,CAGAA,EAAQ+C,KAAKC,IAAI,EAAGD,KAAKE,IAAIlD,EAAaa,MAAM9B,OAAS,EAAGkB,IAC5D,IAAMkD,EAAW5C,EAASM,MAAMK,SAASjB,GACnCmD,EAASnB,EAAUpB,MAAMuC,OAE/BA,EAAOC,gBAAgBF,EAAU,IAGnC,MAAO,CACLnD,eACAiC,YACAnC,uBACAC,uBFgBa,OACblB,KAAM,aACNyE,WAAY,CAAEC,OAAA,QACdlD,MAAO,CACL7B,KAAM,CACJgF,KAAMC,MACNC,QAFI,WAGF,MAAO,MAIbC,MAAO,CAAC,UACRC,MAZa,SAYPvD,EAZO,GAYU,IAARwD,EAAQ,EAARA,KAAQ,EACgDzD,EAASC,GAAtEE,EADa,EACbA,SAAUrB,EADG,EACHA,SAAUW,EADP,EACOA,WAAYD,EADnB,EACmBA,WAAYO,EAD/B,EAC+BA,aAD/B,EAE0D4B,EAAY1B,EAAOE,GAA1FP,EAFa,EAEbA,aAAciC,EAFD,EAECA,UAAWnC,EAFZ,EAEYA,qBAAsBC,EAFlC,EAEkCA,oBAEvD,SAASN,EAAYF,GACnBsE,EAAK,SAAUtE,GAGjB,MAAO,CACLE,cAEAc,WACArB,WACAW,aACAD,aACAO,eAEAH,eACAiC,YACAnC,uBACAC,yB,UGxFR,EAAO+D,OAAS,EAChB,EAAOC,UAAY,kBAEJ,Q,wBJeE,GACblF,KAAM,SACNyE,WAAY,CACVU,UAAA,GAEFxF,KALa,WAMX,MAAO,CACLC,QAAS,GACTK,eAAgB,OAGdmF,QAXO,WAWG,8KACO,iBADP,OACRC,EADQ,OAEd,EAAKzF,QAAUyF,EAAOzF,QAFR,8CAIhB0F,QAAS,CACPzF,aADO,SACM0F,GACXC,KAAKvF,eAAiBsF,EACtBC,KAAKC,YAAYF,GACjBC,KAAKE,QAAQlD,KAAK,CAChBmD,KAAM,WAAF,OAAaJ,EAAOK,QAG5BH,YARO,SAQKF,GACV,OAAQM,QAAQC,IAAI,OAAYP,M,UK1CxC,EAAON,OAASA,EAChB,EAAOC,UAAY,kBAEJ,gB,kCCRf,W,2HCIe,QACblF,KAAM,cACNwB,MAAOkD,OAAOlD,MACdsD,MAAOJ,OAAOI,MACdG,OAJa,SAINc,GACL,OAAOC,eAAEtB,OAAQuB,eAAW,CAC1B9F,IAAK,aACJ4F,EAAIG,OAAQ,CACb7F,SAAU,SAACkD,GACTwC,EAAII,MAAM,SAAU5C,MAEpB,CACFsB,QAASuB,gBAAQ,WACf,MAAO,CAACC,eAAWN,EAAIO,OAAQ,kBAIrCvB,MAjBa,WAkBX,IAAM3B,EAAYjD,eAAI,MAChBoE,EAASzC,gBAAS,WACtB,OAAOsB,EAAUpB,MAAMuC,UAGnBgC,EAAQC,iBACRC,EAAW3E,gBAAS,kBAAMyE,EAAMG,MAAMD,YAO5C,OALA5D,eAAM4D,EAAD,wCAAW,8GACR3D,iBADQ,OAEdyB,EAAOvC,MAAM2E,UAFC,4CAKT,CACLvD,YACAmB,a,2DCrCN,oFAEO,SAASqC,IACd,OAAOC,eAAI,sBAGN,SAASC,EAAgBvB,GAC9B,OAAOsB,eAAI,uBAAwB,CACjCjB,IAAKL,EAAOK,Q,kCCRhB","file":"js/singer.6417ddd2.js","sourcesContent":["<template>\n  <div class=\"singer\" v-loading=\"!singers.length\">\n\n    <index-list\n      :data=\"singers\"\n      @select=\"selectSinger\"\n    ></index-list>\n\n    <router-view v-slot=\"{ Component }\">\n      <transition appear name=\"slide\">\n        <component :is=\"Component\" :data=\"selectedSinger\"/>\n      </transition>\n    </router-view>\n\n  </div>\n</template>\n\n<script>\n  import { getSingerList } from '@/service/singer'\n  import IndexList from '@/components/index-list/index-list'\n  import storage from 'good-storage'\n  import { SINGER_KEY } from '@/assets/js/constant'\n\n  export default {\n    name: 'singer',\n    components: {\n      IndexList\n    },\n    data() {\n      return {\n        singers: [],\n        selectedSinger: null\n      }\n    },\n    async created() {\n      const result = await getSingerList()\n      this.singers = result.singers\n    },\n    methods: {\n      selectSinger(singer) {\n        this.selectedSinger = singer\n        this.cacheSinger(singer)\n        this.$router.push({\n          path: `/singer/${singer.mid}`\n        })\n      },\n      cacheSinger(singer) {\n        storage.session.set(SINGER_KEY, singer)\n      }\n    }\n  }\n</script>\n\n<style lang=\"scss\" scoped>\n  .singer {\n    position: fixed;\n    width: 100%;\n    top: 88px;\n    bottom: 0;\n  }\n</style>\n","<template>\n  <scroll\n    class=\"index-list\"\n    :probe-type=\"3\"\n    @scroll=\"onScroll\"\n    ref=\"scrollRef\"\n  >\n    <ul ref=\"groupRef\">\n      <li\n        v-for=\"group in data\"\n        :key=\"group.title\"\n        class=\"group\"\n      >\n        <h2 class=\"title\">{{group.title}}</h2>\n        <ul>\n          <li\n            v-for=\"item in group.list\"\n            :key=\"item.id\"\n            class=\"item\"\n            @click=\"onItemClick(item)\"\n          >\n            <img class=\"avatar\" v-lazy=\"item.pic\">\n            <span class=\"name\">{{item.name}}</span>\n          </li>\n        </ul>\n      </li>\n    </ul>\n\n    <div\n      class=\"fixed\"\n      v-show=\"fixedTitle\"\n      :style=\"fixedStyle\"\n    >\n      <div class=\"fixed-title\">{{fixedTitle}}</div>\n    </div>\n\n    <div\n      class=\"shortcut\"\n      @touchstart.stop.prevent=\"onShortcutTouchStart\"\n      @touchmove.stop.prevent=\"onShortcutTouchMove\"\n      @touchend.stop.prevent\n    >\n      <ul>\n        <li\n          v-for=\"(item, index) in shortcutList\"\n          :key=\"item\"\n          :data-index=\"index\"\n          class=\"item\"\n          :class=\"{'current':currentIndex===index}\">\n          {{item}}\n        </li>\n      </ul>\n    </div>\n  </scroll>\n</template>\n\n<script>\n  import Scroll from '@/components/wrap-scroll/index'\n  import useFixed from './use-fixed'\n  import useShortcut from './use-shortcut'\n\n  export default {\n    name: 'index-list',\n    components: { Scroll },\n    props: {\n      data: {\n        type: Array,\n        default() {\n          return []\n        }\n      }\n    },\n    emits: ['select'],\n    setup(props, { emit }) {\n      const { groupRef, onScroll, fixedTitle, fixedStyle, currentIndex } = useFixed(props)\n      const { shortcutList, scrollRef, onShortcutTouchStart, onShortcutTouchMove } = useShortcut(props, groupRef)\n\n      function onItemClick(item) {\n        emit('select', item)\n      }\n\n      return {\n        onItemClick,\n        // fixed\n        groupRef,\n        onScroll,\n        fixedTitle,\n        fixedStyle,\n        currentIndex,\n        // shortcut\n        shortcutList,\n        scrollRef,\n        onShortcutTouchStart,\n        onShortcutTouchMove\n      }\n    }\n  }\n</script>\n\n<style lang=\"scss\" scoped>\n  .index-list {\n    position: relative;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n    background: $color-background;\n    .group {\n      padding-bottom: 30px;\n      .title {\n        height: 30px;\n        line-height: 30px;\n        padding-left: 20px;\n        font-size: $font-size-small;\n        color: $color-text-l;\n        background: $color-highlight-background;\n      }\n      .item {\n        display: flex;\n        align-items: center;\n        padding: 20px 0 0 30px;\n        .avatar {\n          width: 50px;\n          height: 50px;\n          border-radius: 50%;\n        }\n        .name {\n          margin-left: 20px;\n          color: $color-text-l;\n          font-size: $font-size-medium;\n        }\n      }\n    }\n    .fixed {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      .fixed-title {\n        height: 30px;\n        line-height: 30px;\n        padding-left: 20px;\n        font-size: $font-size-small;\n        color: $color-text-l;\n        background: $color-highlight-background;\n      }\n    }\n    .shortcut {\n      position: absolute;\n      right: 4px;\n      top: 50%;\n      transform: translateY(-50%);\n      width: 20px;\n      padding: 20px 0;\n      border-radius: 10px;\n      text-align: center;\n      background: $color-background-d;\n      font-family: Helvetica;\n      .item {\n        padding: 3px;\n        line-height: 1;\n        color: $color-text-l;\n        font-size: $font-size-small;\n        &.current {\n          color: $color-theme\n        }\n      }\n    }\n  }\n</style>\n","import { ref, watch, computed, nextTick } from 'vue'\n\nexport default function useFixed(props) {\n  const TITLE_HEIGHT = 30\n  const groupRef = ref(null)\n  const listHeights = ref([])\n  const scrollY = ref(0)\n  const currentIndex = ref(0)\n  const distance = ref(0)\n\n  const fixedStyle = computed(() => {\n    const distanceVal = distance.value\n    const diff = (distanceVal > 0 && distanceVal < TITLE_HEIGHT) ? distanceVal - TITLE_HEIGHT : 0\n    return {\n      transform: `translate3d(0,${diff}px,0)`\n    }\n  })\n\n  const fixedTitle = computed(() => {\n    if (scrollY.value < 0) {\n      return ''\n    }\n    const currentGroup = props.data[currentIndex.value]\n    return currentGroup ? currentGroup.title : ''\n  })\n\n  watch(() => props.data, async () => {\n    await nextTick()\n    calculate()\n  })\n\n  watch(scrollY, (newY) => {\n    const listHeightsVal = listHeights.value\n    for (let i = 0; i < listHeightsVal.length - 1; i++) {\n      const heightTop = listHeightsVal[i]\n      const heightBottom = listHeightsVal[i + 1]\n      if (newY >= heightTop && newY <= heightBottom) {\n        currentIndex.value = i\n        distance.value = heightBottom - newY\n      }\n    }\n  })\n\n  function calculate() {\n    const list = groupRef.value.children\n    const listHeightsVal = listHeights.value\n    let height = 0\n\n    listHeightsVal.length = 0\n    listHeightsVal.push(height)\n\n    for (let i = 0; i < list.length; i++) {\n      height += list[i].clientHeight\n      listHeightsVal.push(height)\n    }\n  }\n\n  function onScroll(pos) {\n    scrollY.value = -pos.y\n  }\n\n  return {\n    groupRef,\n    onScroll,\n    fixedTitle,\n    fixedStyle,\n    currentIndex\n  }\n}\n","import { ref, computed } from 'vue'\n\nexport default function useShortcut(props, groupRef) {\n  const ANCHOR_HEIGHT = 18\n  const scrollRef = ref(null)\n\n  const shortcutList = computed(() => {\n    return props.data.map((group) => {\n      return group.title\n    })\n  })\n\n  const touch = {}\n\n  function onShortcutTouchStart(e) {\n    const anchorIndex = parseInt(e.target.dataset.index)\n    touch.y1 = e.touches[0].pageY\n    touch.anchorIndex = anchorIndex\n\n    scrollTo(anchorIndex)\n  }\n\n  function onShortcutTouchMove(e) {\n    touch.y2 = e.touches[0].pageY\n    const delta = (touch.y2 - touch.y1) / ANCHOR_HEIGHT | 0\n    const anchorIndex = touch.anchorIndex + delta\n\n    scrollTo(anchorIndex)\n  }\n\n  function scrollTo(index) {\n    if (isNaN(index)) {\n      return\n    }\n    index = Math.max(0, Math.min(shortcutList.value.length - 1, index))\n    const targetEl = groupRef.value.children[index]\n    const scroll = scrollRef.value.scroll\n\n    scroll.scrollToElement(targetEl, 0)\n  }\n\n  return {\n    shortcutList,\n    scrollRef,\n    onShortcutTouchStart,\n    onShortcutTouchMove\n  }\n}\n","import { render } from \"./index-list.vue?vue&type=template&id=47eb5614&scoped=true\"\nimport script from \"./index-list.vue?vue&type=script&lang=js\"\nexport * from \"./index-list.vue?vue&type=script&lang=js\"\n\nimport \"./index-list.vue?vue&type=style&index=0&id=47eb5614&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-47eb5614\"\n\nexport default script","import { render } from \"./singer.vue?vue&type=template&id=418778bc&scoped=true\"\nimport script from \"./singer.vue?vue&type=script&lang=js\"\nexport * from \"./singer.vue?vue&type=script&lang=js\"\n\nimport \"./singer.vue?vue&type=style&index=0&id=418778bc&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-418778bc\"\n\nexport default script","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./singer.vue?vue&type=style&index=0&id=418778bc&lang=scss&scoped=true\"","import { h, mergeProps, withCtx, renderSlot, ref, computed, watch, nextTick } from 'vue'\nimport Scroll from '@/components/base/scroll/scroll'\nimport { useStore } from 'vuex'\n\nexport default {\n  name: 'wrap-scroll',\n  props: Scroll.props,\n  emits: Scroll.emits,\n  render(ctx) {\n    return h(Scroll, mergeProps({\n      ref: 'scrollRef'\n    }, ctx.$props, {\n      onScroll: (e) => {\n        ctx.$emit('scroll', e)\n      }\n    }), {\n      default: withCtx(() => {\n        return [renderSlot(ctx.$slots, 'default')]\n      })\n    })\n  },\n  setup() {\n    const scrollRef = ref(null)\n    const scroll = computed(() => {\n      return scrollRef.value.scroll\n    })\n\n    const store = useStore()\n    const playlist = computed(() => store.state.playlist)\n\n    watch(playlist, async () => {\n      await nextTick()\n      scroll.value.refresh()\n    })\n\n    return {\n      scrollRef,\n      scroll\n    }\n  }\n}\n","import { get } from './base'\n\nexport function getSingerList() {\n  return get('/api/getSingerList')\n}\n\nexport function getSingerDetail(singer) {\n  return get('/api/getSingerDetail', {\n    mid: singer.mid\n  })\n}\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./index-list.vue?vue&type=style&index=0&id=47eb5614&lang=scss&scoped=true\""],"sourceRoot":""}